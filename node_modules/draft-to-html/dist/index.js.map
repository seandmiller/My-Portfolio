{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["// @flow\n\nconst blockTypes = {\n  'header-one': 'H1',\n  'header-two': 'H2',\n  'header-three': 'H3',\n  'header-four': 'H4',\n  'header-five': 'H5',\n  'header-six': 'H6',\n  'unordered-list-item': 'LI',\n  'ordered-list-item': 'LI',\n  'blockquote': 'BLOCKQUOTE',\n  'code-block': 'PRE',\n  'unstyled': 'P',\n  'paragraph': 'P'\n}\n\nconst inlineStyleTags = {\n  'BOLD': 'strong',\n  'CODE': 'code',\n  'ITALIC': 'em',\n  'STRIKETHROUGH': 'strike',\n  'UNDERLINE': 'u'\n}\n\nconst listElements = {\n  'unordered-list-item': 'UL',\n  'ordered-list-item': 'OL'\n}\n\nconst parseEntity = (entity, options = {}) => {\n  let customParsed = null\n  let parsed = null\n\n  if (entity.type.toUpperCase() === 'LINK' &&\n    entity.data != null &&\n    entity.data.src != null) {\n    parsed = document.createElement('A')\n    parsed.setAttribute('href', entity.data.src)\n  }\n\n  if (options.parseEntity != null) {\n    customParsed = options.parseEntity(entity)\n    if (customParsed != null) {\n      parsed = customParsed\n    }\n  }\n\n  return parsed\n}\n\nconst parseStyle = (style, options = {}) => {\n  let element = document.createElement(inlineStyleTags[style.toUpperCase()] || 'span')\n  if (options.parseStyle != null) {\n    element = options.parseStyle(style) || element\n  }\n\n  return element\n}\n\nconst getCharacterRanges = block => {\n  return block.characterList.reduce((ranges, characterData, index) => {\n    const lastRange = ranges.slice(-1)[0]\n\n    if (lastRange != null && lastRange.characterData.equals(characterData)) {\n      lastRange.length++\n      return ranges\n    } else {\n      return [\n        ...ranges,\n        {\n          offset: index,\n          length: 1,\n          characterData\n        }\n      ]\n    }\n  }, [])\n}\n\nconst appendTextFragments = (block, element, contentState, options = {}) => {\n  const text = block.getText()\n\n  if (block.getType().toLowerCase() === 'atomic') {\n    return\n  }\n\n  const characterRanges = getCharacterRanges(block)\n\n  characterRanges.forEach(({\n    offset,\n    length,\n    characterData\n  }) => {\n    const start = offset\n    const end = offset + length\n    const { style } = characterData\n    const entity = characterData.entity != null ? contentState.getEntity(characterData.entity) : null\n\n    // console.log('text', text.slice(start, end))\n    // console.log('characterData', characterData)\n    // console.log('start', start, 'end', end)\n\n    let innerText = document.createTextNode(text.slice(start, end))\n\n    if (style != null && style.size > 0) {\n      style.forEach(style => {\n        const parsedStyle = parseStyle(style)\n        if (parsedStyle != null) {\n          parsedStyle.appendChild(innerText)\n          innerText = parsedStyle\n        }\n      })\n    }\n\n    if (entity != null) {\n      const parsedEntity = parseEntity(entity, options)\n\n      if (parsedEntity != null) {\n        parsedEntity.appendChild(innerText)\n        innerText = parsedEntity\n      }\n    }\n\n    element.appendChild(innerText)\n  })\n}\n\nconst parseBlock = (block, contentState, options = {}) => {\n  let customParsed = null\n  let parsed = { nodeName: blockTypes[block.getType()] || 'P' }\n\n  if (options.parseBlock != null) {\n    customParsed = options.parseBlock(block, contentState)\n    if (customParsed != null) {\n      parsed = customParsed\n    }\n  }\n\n  return parsed\n}\n\nconst convertToHtml = (contentState, options = {}) => {\n  const blocks = contentState.getBlocksAsArray()\n  const root = document.createElement('body')\n\n  blocks.forEach(block => {\n    const { nodeName, ...attrs } = parseBlock(block, contentState, options)\n    const element = document.createElement(nodeName)\n\n    Object.keys(attrs).forEach(attr => {\n      element.setAttribute(attr, attrs[attr])\n    })\n\n    appendTextFragments(block, element, contentState, options)\n\n    if (block.getType().includes('ordered-list-item')) {\n      if (root.lastChild == null || listElements[block.getType()] !== root.lastChild.nodeName) {\n        root.appendChild(document.createElement(listElements[block.getType()]))\n      }\n\n      root.lastChild.appendChild(element)\n    } else {\n      root.appendChild(element)\n    }\n  })\n\n  return root.innerHTML\n}\n\nexport default convertToHtml\n"],"names":["blockTypes","inlineStyleTags","listElements","parseEntity","entity","options","customParsed","parsed","type","toUpperCase","data","src","document","createElement","setAttribute","parseStyle","style","element","getCharacterRanges","block","characterList","reduce","ranges","characterData","index","lastRange","slice","equals","length","offset","appendTextFragments","contentState","text","getText","getType","toLowerCase","characterRanges","forEach","start","end","getEntity","innerText","createTextNode","size","parsedStyle","appendChild","parsedEntity","parseBlock","nodeName","convertToHtml","blocks","getBlocksAsArray","root","attrs","Object","keys","attr","includes","lastChild","innerHTML"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,UAAU,GAAG;gBACH,IADG;gBAEH,IAFG;kBAGD,IAHC;iBAIF,IAJE;iBAKF,IALE;gBAMH,IANG;yBAOM,IAPN;uBAQI,IARJ;gBASH,YATG;gBAUH,KAVG;cAWL,GAXK;eAYJ;CAZf;AAeA,IAAMC,eAAe,GAAG;UACd,QADc;UAEd,MAFc;YAGZ,IAHY;mBAIL,QAJK;eAKT;CALf;AAQA,IAAMC,YAAY,GAAG;yBACI,IADJ;uBAEE;CAFvB;;AAKA,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAACC,MAAD,EAA0B;MAAjBC,OAAiB,uEAAP,EAAO;MACxCC,YAAY,GAAG,IAAnB;MACIC,MAAM,GAAG,IAAb;;MAEIH,MAAM,CAACI,IAAP,CAAYC,WAAZ,OAA8B,MAA9B,IACFL,MAAM,CAACM,IAAP,IAAe,IADb,IAEFN,MAAM,CAACM,IAAP,CAAYC,GAAZ,IAAmB,IAFrB,EAE2B;IACzBJ,MAAM,GAAGK,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAT;IACAN,MAAM,CAACO,YAAP,CAAoB,MAApB,EAA4BV,MAAM,CAACM,IAAP,CAAYC,GAAxC;;;MAGEN,OAAO,CAACF,WAAR,IAAuB,IAA3B,EAAiC;IAC/BG,YAAY,GAAGD,OAAO,CAACF,WAAR,CAAoBC,MAApB,CAAf;;QACIE,YAAY,IAAI,IAApB,EAA0B;MACxBC,MAAM,GAAGD,YAAT;;;;SAIGC,MAAP;CAlBF;;AAqBA,IAAMQ,UAAU,GAAG,SAAbA,UAAa,CAACC,KAAD,EAAyB;MAAjBX,OAAiB,uEAAP,EAAO;MACtCY,OAAO,GAAGL,QAAQ,CAACC,aAAT,CAAuBZ,eAAe,CAACe,KAAK,CAACP,WAAN,EAAD,CAAf,IAAwC,MAA/D,CAAd;;MACIJ,OAAO,CAACU,UAAR,IAAsB,IAA1B,EAAgC;IAC9BE,OAAO,GAAGZ,OAAO,CAACU,UAAR,CAAmBC,KAAnB,KAA6BC,OAAvC;;;SAGKA,OAAP;CANF;;AASA,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,CAAAC,KAAK,EAAI;SAC3BA,KAAK,CAACC,aAAN,CAAoBC,MAApB,CAA2B,UAACC,MAAD,EAASC,aAAT,EAAwBC,KAAxB,EAAkC;QAC5DC,SAAS,GAAGH,MAAM,CAACI,KAAP,CAAa,CAAC,CAAd,EAAiB,CAAjB,CAAlB;;QAEID,SAAS,IAAI,IAAb,IAAqBA,SAAS,CAACF,aAAV,CAAwBI,MAAxB,CAA+BJ,aAA/B,CAAzB,EAAwE;MACtEE,SAAS,CAACG,MAAV;aACON,MAAP;KAFF,MAGO;gCAEAA,MADL,UAEE;QACEO,MAAM,EAAEL,KADV;QAEEI,MAAM,EAAE,CAFV;QAGEL,aAAa,EAAbA;OALJ;;GAPG,EAgBJ,EAhBI,CAAP;CADF;;AAoBA,IAAMO,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACX,KAAD,EAAQF,OAAR,EAAiBc,YAAjB,EAAgD;MAAjB1B,OAAiB,uEAAP,EAAO;MACpE2B,IAAI,GAAGb,KAAK,CAACc,OAAN,EAAb;;MAEId,KAAK,CAACe,OAAN,GAAgBC,WAAhB,OAAkC,QAAtC,EAAgD;;;;MAI1CC,eAAe,GAAGlB,kBAAkB,CAACC,KAAD,CAA1C;EAEAiB,eAAe,CAACC,OAAhB,CAAwB,gBAIlB;QAHJR,MAGI,QAHJA,MAGI;QAFJD,MAEI,QAFJA,MAEI;QADJL,aACI,QADJA,aACI;QACEe,KAAK,GAAGT,MAAd;QACMU,GAAG,GAAGV,MAAM,GAAGD,MAArB;QACQZ,KAHJ,GAGcO,aAHd,CAGIP,KAHJ;QAIEZ,MAAM,GAAGmB,aAAa,CAACnB,MAAd,IAAwB,IAAxB,GAA+B2B,YAAY,CAACS,SAAb,CAAuBjB,aAAa,CAACnB,MAArC,CAA/B,GAA8E,IAA7F,CAJI;;;;QAUAqC,SAAS,GAAG7B,QAAQ,CAAC8B,cAAT,CAAwBV,IAAI,CAACN,KAAL,CAAWY,KAAX,EAAkBC,GAAlB,CAAxB,CAAhB;;QAEIvB,KAAK,IAAI,IAAT,IAAiBA,KAAK,CAAC2B,IAAN,GAAa,CAAlC,EAAqC;MACnC3B,KAAK,CAACqB,OAAN,CAAc,UAAArB,KAAK,EAAI;YACf4B,WAAW,GAAG7B,UAAU,CAACC,KAAD,CAA9B;;YACI4B,WAAW,IAAI,IAAnB,EAAyB;UACvBA,WAAW,CAACC,WAAZ,CAAwBJ,SAAxB;UACAA,SAAS,GAAGG,WAAZ;;OAJJ;;;QASExC,MAAM,IAAI,IAAd,EAAoB;UACZ0C,YAAY,GAAG3C,WAAW,CAACC,MAAD,EAASC,OAAT,CAAhC;;UAEIyC,YAAY,IAAI,IAApB,EAA0B;QACxBA,YAAY,CAACD,WAAb,CAAyBJ,SAAzB;QACAA,SAAS,GAAGK,YAAZ;;;;IAIJ7B,OAAO,CAAC4B,WAAR,CAAoBJ,SAApB;GAnCF;CATF;;AAgDA,IAAMM,UAAU,GAAG,SAAbA,UAAa,CAAC5B,KAAD,EAAQY,YAAR,EAAuC;MAAjB1B,OAAiB,uEAAP,EAAO;MACpDC,YAAY,GAAG,IAAnB;MACIC,MAAM,GAAG;IAAEyC,QAAQ,EAAEhD,UAAU,CAACmB,KAAK,CAACe,OAAN,EAAD,CAAV,IAA+B;GAAxD;;MAEI7B,OAAO,CAAC0C,UAAR,IAAsB,IAA1B,EAAgC;IAC9BzC,YAAY,GAAGD,OAAO,CAAC0C,UAAR,CAAmB5B,KAAnB,EAA0BY,YAA1B,CAAf;;QACIzB,YAAY,IAAI,IAApB,EAA0B;MACxBC,MAAM,GAAGD,YAAT;;;;SAIGC,MAAP;CAXF;;AAcA,IAAM0C,aAAa,GAAG,SAAhBA,aAAgB,CAAClB,YAAD,EAAgC;MAAjB1B,OAAiB,uEAAP,EAAO;MAC9C6C,MAAM,GAAGnB,YAAY,CAACoB,gBAAb,EAAf;MACMC,IAAI,GAAGxC,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAb;EAEAqC,MAAM,CAACb,OAAP,CAAe,UAAAlB,KAAK,EAAI;sBACS4B,UAAU,CAAC5B,KAAD,EAAQY,YAAR,EAAsB1B,OAAtB,CADnB;QACd2C,QADc,eACdA,QADc;QACDK,KADC;;QAEhBpC,OAAO,GAAGL,QAAQ,CAACC,aAAT,CAAuBmC,QAAvB,CAAhB;IAEAM,MAAM,CAACC,IAAP,CAAYF,KAAZ,EAAmBhB,OAAnB,CAA2B,UAAAmB,IAAI,EAAI;MACjCvC,OAAO,CAACH,YAAR,CAAqB0C,IAArB,EAA2BH,KAAK,CAACG,IAAD,CAAhC;KADF;IAIA1B,mBAAmB,CAACX,KAAD,EAAQF,OAAR,EAAiBc,YAAjB,EAA+B1B,OAA/B,CAAnB;;QAEIc,KAAK,CAACe,OAAN,GAAgBuB,QAAhB,CAAyB,mBAAzB,CAAJ,EAAmD;UAC7CL,IAAI,CAACM,SAAL,IAAkB,IAAlB,IAA0BxD,YAAY,CAACiB,KAAK,CAACe,OAAN,EAAD,CAAZ,KAAkCkB,IAAI,CAACM,SAAL,CAAeV,QAA/E,EAAyF;QACvFI,IAAI,CAACP,WAAL,CAAiBjC,QAAQ,CAACC,aAAT,CAAuBX,YAAY,CAACiB,KAAK,CAACe,OAAN,EAAD,CAAnC,CAAjB;;;MAGFkB,IAAI,CAACM,SAAL,CAAeb,WAAf,CAA2B5B,OAA3B;KALF,MAMO;MACLmC,IAAI,CAACP,WAAL,CAAiB5B,OAAjB;;GAjBJ;SAqBOmC,IAAI,CAACO,SAAZ;CAzBF;;;;"}